<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Libc++ 18.0.0 (In-Progress) Release Notes &#8212; libc++  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=e491ac2d" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Libc++ 20.0.0 (In-Progress) Release Notes" href="20.html" />
    <link rel="prev" title="Libc++ 19.0.0 (In-Progress) Release Notes" href="../ReleaseNotes.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>libc++  documentation</span></a></h1>
        <h2 class="heading"><span>Libc++ 18.0.0 (In-Progress) Release Notes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="../ReleaseNotes.html">Libc++ 19.0.0 (In-Progress) Release Notes</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="20.html">Libc++ 20.0.0 (In-Progress) Release Notes</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="libc-18-0-0-in-progress-release-notes">
<h1>Libc++ 18.0.0 (In-Progress) Release Notes<a class="headerlink" href="#libc-18-0-0-in-progress-release-notes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id3">Introduction</a></p></li>
<li><p><a class="reference internal" href="#what-s-new-in-libc-18-0-0" id="id4">What’s New in Libc++ 18.0.0?</a></p>
<ul>
<li><p><a class="reference internal" href="#implemented-papers" id="id5">Implemented Papers</a></p></li>
<li><p><a class="reference internal" href="#improvements-and-new-features" id="id6">Improvements and New Features</a></p></li>
<li><p><a class="reference internal" href="#deprecations-and-removals" id="id7">Deprecations and Removals</a></p></li>
<li><p><a class="reference internal" href="#upcoming-deprecations-and-removals" id="id8">Upcoming Deprecations and Removals</a></p></li>
<li><p><a class="reference internal" href="#abi-affecting-changes" id="id9">ABI Affecting Changes</a></p></li>
<li><p><a class="reference internal" href="#build-system-changes" id="id10">Build System Changes</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>Written by the <a class="reference external" href="https://libcxx.llvm.org">Libc++ Team</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These are in-progress notes for the upcoming libc++ 18.0.0 release.
Release notes for previous releases can be found on
<a class="reference external" href="https://releases.llvm.org/download.html">the Download Page</a>.</p>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This document contains the release notes for the libc++ C++ Standard Library,
part of the LLVM Compiler Infrastructure, release 18.0.0. Here we describe the
status of libc++ in some detail, including major improvements from the previous
release and new feature work. For the general LLVM release notes, see <a class="reference external" href="https://llvm.org/docs/ReleaseNotes.html">the LLVM
documentation</a>. All LLVM releases may
be downloaded from the <a class="reference external" href="https://llvm.org/releases/">LLVM releases web site</a>.</p>
<p>For more information about libc++, please see the <a class="reference external" href="https://libcxx.llvm.org">Libc++ Web Site</a> or the <a class="reference external" href="https://llvm.org">LLVM Web Site</a>.</p>
<p>Note that if you are reading this file from a Git checkout or the
main Libc++ web page, this document applies to the <em>next</em> release, not
the current one. To see the release notes for a specific release, please
see the <a class="reference external" href="https://llvm.org/releases/">releases page</a>.</p>
</section>
<section id="what-s-new-in-libc-18-0-0">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">What’s New in Libc++ 18.0.0?</a><a class="headerlink" href="#what-s-new-in-libc-18-0-0" title="Link to this heading">¶</a></h2>
<p>The main focus of the libc++ team has been to implement new C++20, C++23,
and C++26 features.</p>
<p>New hardened modes for the library have been added, replacing the legacy debug mode that was
removed in the LLVM 17 release. Unlike the legacy debug mode, some of these hardening modes are
also intended to be used in production. See <a class="reference internal" href="../Hardening.html#hardening"><span class="std std-ref">Hardening Modes</span></a> for more details.</p>
<p>Work on the ranges support has progressed. See
<a class="reference internal" href="../Status/Ranges.html#ranges-status"><span class="std std-ref">libc++ Ranges Status</span></a> for the current status.</p>
<p>Work on the experimental C++23 module support has progressed. The <code class="docutils literal notranslate"><span class="pre">std.compat</span></code>
module is available and the feature is retroactively available in C++20. See
<a class="reference internal" href="../Modules.html#modulesinlibcxx"><span class="std std-ref">Modules in libc++</span></a> for more information.</p>
<p>Work on the experimental C++17 Parallel STL has progressed. See
<a class="reference internal" href="../Status/PSTL.html#pstl-status"><span class="std std-ref">libc++ Parallel STL Status</span></a> for the current status.</p>
<p>Work on the experimental C++17 SIMD support has progressed. See
<a class="reference internal" href="../Status/Parallelism.html#parallelism-status"><span class="std std-ref">libc++ Parallelism TS Status (N4808)</span></a> for the current status.</p>
<section id="implemented-papers">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Implemented Papers</a><a class="headerlink" href="#implemented-papers" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>P2093R14 - Formatted output</p></li>
<li><p>P2539R4  - Should the output of <code class="docutils literal notranslate"><span class="pre">std::print</span></code> to a terminal be synchronized with the underlying stream?</p></li>
<li><p>P2497R0 - Testing for success or failure of <code class="docutils literal notranslate"><span class="pre">&lt;charconv&gt;</span></code> functions</p></li>
<li><p>P2697R1 - Interfacing <code class="docutils literal notranslate"><span class="pre">bitset</span></code> with <code class="docutils literal notranslate"><span class="pre">string_view</span></code></p></li>
<li><p>P2443R1 - <code class="docutils literal notranslate"><span class="pre">views::chunk_by</span></code></p></li>
<li><p>P2538R1 - ADL-proof <code class="docutils literal notranslate"><span class="pre">std::projected</span></code></p></li>
<li><p>P2614R2 - Deprecate <code class="docutils literal notranslate"><span class="pre">numeric_limits::has_denorm</span></code></p></li>
<li><p>P0053R7 - C++ Synchronized Buffered Ostream (in the experimental library)</p></li>
<li><p>P2467R1 - Support exclusive mode for fstreams</p></li>
<li><p>P0020R6 - Floating Point Atomic</p></li>
<li><p>P2905R2 - Runtime format strings</p></li>
<li><p>P2918R2 - Runtime format strings II</p></li>
<li><p>P2871R3 - Remove Deprecated Unicode Conversion Facets from C++26</p></li>
<li><p>P2870R3 - Remove <code class="docutils literal notranslate"><span class="pre">basic_string::reserve()</span></code></p></li>
<li><p>P2909R4 - Fix formatting of code units as integers (Dude, where’s my <code class="docutils literal notranslate"><span class="pre">char</span></code>?)</p></li>
<li><p>P2821R5 - <code class="docutils literal notranslate"><span class="pre">span.at()</span></code></p></li>
<li><p>P0521R0 - Proposed Resolution for CA 14 (<code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code> <code class="docutils literal notranslate"><span class="pre">use_count/unique</span></code>)</p></li>
<li><p>P0543R3 - Saturation arithmetic</p></li>
<li><p>P1759R6 - Native handles and file streams</p></li>
<li><p>P2868R3 - Remove Deprecated <code class="docutils literal notranslate"><span class="pre">std::allocator</span></code> Typedef From C++26</p></li>
<li><p>P2517R1 - Add a conditional <code class="docutils literal notranslate"><span class="pre">noexcept</span></code> specification to <code class="docutils literal notranslate"><span class="pre">std::apply</span></code></p></li>
<li><p>P2447R6 - <code class="docutils literal notranslate"><span class="pre">span</span></code> over initializer list</p></li>
</ul>
</section>
<section id="improvements-and-new-features">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Improvements and New Features</a><a class="headerlink" href="#improvements-and-new-features" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">std::ranges::count</span></code> and <code class="docutils literal notranslate"><span class="pre">std::ranges::find</span></code> are  now optimized for
<code class="docutils literal notranslate"><span class="pre">std::vector&lt;bool&gt;::iterator</span></code>, which can lead up to 350x performance
improvements.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std::for_each</span></code> has been optimized for segmented iterators like <code class="docutils literal notranslate"><span class="pre">std::deque::iterator</span></code> in C++23 and
later, which can lead up to 40x performance improvements.</p></li>
<li><p>The library now provides several hardening modes under which common cases of library undefined behavior will be turned
into a reliable program termination. The <code class="docutils literal notranslate"><span class="pre">fast</span></code> hardening mode enables a set of security-critical checks with
minimal runtime overhead; the <code class="docutils literal notranslate"><span class="pre">extensive</span></code> hardening mode additionally enables relatively cheap checks that catch
common logic errors but aren’t necessarily security-critical; and the <code class="docutils literal notranslate"><span class="pre">debug</span></code> hardening mode enables all available
checks, some of which might be very expensive. Vendors can configure which hardening mode is enabled by default with
the <code class="docutils literal notranslate"><span class="pre">LIBCXX_HARDENING_MODE</span></code> variable at CMake configuration time. Users can control which hardening mode is enabled
on a per translation unit basis using the <code class="docutils literal notranslate"><span class="pre">_LIBCPP_HARDENING_MODE</span></code> macro. See <a class="reference internal" href="../Hardening.html#using-hardening-modes"><span class="std std-ref">the hardening documentation</span></a> for more details.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX26_REMOVED_CODECVT</span></code> macro has been added to make
the declarations in <code class="docutils literal notranslate"><span class="pre">&lt;codecvt&gt;</span></code> available.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX26_REMOVED_STRING_RESERVE</span></code> macro has been added to make
the function <code class="docutils literal notranslate"><span class="pre">std::basic_string&lt;...&gt;::reserve()</span></code> available.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX26_REMOVED_ALLOCATOR_MEMBERS</span></code> macro has been added to make
the function <code class="docutils literal notranslate"><span class="pre">allocator&lt;T&gt;::is_always_equal</span></code> available.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX20_REMOVED_SHARED_PTR_UNIQUE</span></code> macro has been added to make
the function <code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;...&gt;::unique()</span></code> available.</p></li>
<li><p>The cmake option <code class="docutils literal notranslate"><span class="pre">LIBCXX_ENABLE_STD_MODULES</span></code> has been removed. The test
infrastructure no longer depends on a modern CMake, it works with the minimal
required LLVM version (3.20.0).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">.cppm</span></code> files of experimental standard library modules can now be
installed. By default, they are not installed. This can be enabled by
configuring CMake with <code class="docutils literal notranslate"><span class="pre">-DLIBCXX_INSTALL_MODULES=ON</span></code>. The installation
directory can be configured with the CMake option
<code class="docutils literal notranslate"><span class="pre">-DLIBCXX_INSTALL_MODULE_DIR=&lt;path&gt;</span></code>. The default location is
<code class="docutils literal notranslate"><span class="pre">${PREFIX}/share/libc++/v1</span></code>.</p></li>
<li><p>AddressSanitizer annotations have been added to <code class="docutils literal notranslate"><span class="pre">std::basic_string</span></code>.
These annotations are enabled for all allocators by default.
It’s only enabled for long strings, strings using the small buffer optimization are not annotated.</p></li>
<li><p>The libc++ source code has been formatted with <code class="docutils literal notranslate"><span class="pre">clang-format</span></code>. This
<a class="reference external" href="https://discourse.llvm.org/t/rfc-clang-formatting-all-of-libc-once-and-for-all">discourse thread</a>
contains information how to rebase downstream patches.</p></li>
</ul>
</section>
<section id="deprecations-and-removals">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Deprecations and Removals</a><a class="headerlink" href="#deprecations-and-removals" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Availability macros which will never trigger an error have been removed. This includes anything that has been
introduced before macOS 10.13, iOS 12, tvOS 12 and watchOS 4. This shouldn’t affect anybody, since AppleClang 15
doesn’t support any older OSes. If you are a vendor and make use of these macros, please inform the libc++ team so we
can re-introduce them and consider upstreaming support for your platform.</p></li>
<li><p>The non-conforming constructor <code class="docutils literal notranslate"><span class="pre">std::future_error(std::error_code)</span></code> has been removed. Please use the
<code class="docutils literal notranslate"><span class="pre">std::future_error(std::future_errc)</span></code> constructor provided in C++17 instead.</p></li>
<li><p><a class="reference external" href="https://wg21.link/P1957">P1957</a> has been implemented in Clang and libc++ removed a code path that led to
narrowing conversions in <code class="docutils literal notranslate"><span class="pre">std::variant</span></code> behaving in a non-standard way. This may change how some uses of
<code class="docutils literal notranslate"><span class="pre">std::variant</span></code>’s constructor behave in user code. The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_NARROWING_CONVERSIONS_IN_VARIANT</span></code>
macro is provided to restore the previous behavior, and it will be supported in the LLVM 18 release only.
In LLVM 19 and beyond, <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_NARROWING_CONVERSIONS_IN_VARIANT</span></code> will not be honored anymore.</p></li>
<li><p>Overriding <code class="docutils literal notranslate"><span class="pre">__libcpp_verbose_abort</span></code> no longer has any effect on library assertions. The only supported way
to customize the assertion handler that gets invoked when a hardening assertion fails is now by setting the
<code class="docutils literal notranslate"><span class="pre">LIBCXX_ASSERTION_HANDLER_FILE</span></code> CMake variable and providing a custom header. See the documentation on
overriding the default assertion handler for details. The ability to override <code class="docutils literal notranslate"><span class="pre">__libcpp_verbose_abort</span></code>
will be removed in an upcoming release in favor of the new overriding mechanism.</p></li>
<li><p>In safe mode (which is now equivalent to the <code class="docutils literal notranslate"><span class="pre">extensive</span></code> hardening mode), a failed assertion will now
generate a trap rather than a call to verbose abort.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_AVAILABILITY_CUSTOM_VERBOSE_ABORT_PROVIDED</span></code> macro is not honored anymore in LLVM 18.
Please see the updated documentation about the hardening modes in libc++ and in particular on
overriding the default assertion handler.</p></li>
<li><p>The headers <code class="docutils literal notranslate"><span class="pre">&lt;experimental/deque&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/forward_list&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/list&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;experimental/map&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/memory_resource&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/regex&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/set&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;experimental/string&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/unordered_map&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;experimental/unordered_set&gt;</span></code>,
and <code class="docutils literal notranslate"><span class="pre">&lt;experimental/vector&gt;</span></code> have been removed in LLVM 18, as all their contents will have been
implemented in namespace <code class="docutils literal notranslate"><span class="pre">std</span></code> for at least two releases.</p></li>
<li><p>The macro <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX20_REMOVED_ALLOCATOR_MEMBERS</span></code> has been deprecated and will be removed
in LLVM 19. This macro used to re-enable redundant members of <code class="docutils literal notranslate"><span class="pre">std::allocator&lt;T&gt;</span></code> like <code class="docutils literal notranslate"><span class="pre">pointer</span></code>,
<code class="docutils literal notranslate"><span class="pre">reference</span></code>, <code class="docutils literal notranslate"><span class="pre">rebind</span></code>, <code class="docutils literal notranslate"><span class="pre">address</span></code>, <code class="docutils literal notranslate"><span class="pre">max_size</span></code>, <code class="docutils literal notranslate"><span class="pre">construct</span></code>, <code class="docutils literal notranslate"><span class="pre">destroy</span></code>, and the two-argument
overload of <code class="docutils literal notranslate"><span class="pre">allocate</span></code>. However, this led to the library being non-conforming due to incorrect
constexpr-ness.</p></li>
<li><p>The macros <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX17_REMOVED_FEATURES</span></code> and
<code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX20_REMOVED_FEATURES</span></code> have been deprecated and
will be removed in LLVM 19. These macros used to re-enable all features
that were removed in the C++17 and C++20 standards. Instead of using these
macros, please use the macros to re-enable individual features.</p></li>
<li><p>The macro <code class="docutils literal notranslate"><span class="pre">_LIBCPP_INLINE_VISIBILITY</span></code> has been deprecated in LLVM 18 and
will be removed entirely in LLVM 19. The macro <code class="docutils literal notranslate"><span class="pre">_LIBCPP_HIDE_FROM_ABI</span></code> is
the drop-in replacement.</p></li>
<li><p>The macro <code class="docutils literal notranslate"><span class="pre">_VSTD</span></code> has been deprecated in LLVM 18 and will be removed
entirely in LLVM 19. The code <code class="docutils literal notranslate"><span class="pre">std</span></code> is the drop-in replacement.</p></li>
</ul>
</section>
<section id="upcoming-deprecations-and-removals">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Upcoming Deprecations and Removals</a><a class="headerlink" href="#upcoming-deprecations-and-removals" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The ability to override <code class="docutils literal notranslate"><span class="pre">__libcpp_verbose_abort</span></code> will be removed in an upcoming release.</p></li>
</ul>
<section id="llvm-19">
<h4>LLVM 19<a class="headerlink" href="#llvm-19" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">LIBCXX_EXECUTOR</span></code> CMake variable has been deprecated.  LLVM 19 will
completely remove support for the <code class="docutils literal notranslate"><span class="pre">*_EXECUTOR</span></code> variables.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">LIBCXX_ENABLE_ASSERTIONS</span></code> CMake variable that was used to enable the safe mode will be deprecated and setting
it will trigger an error; use the <code class="docutils literal notranslate"><span class="pre">LIBCXX_HARDENING_MODE</span></code> variable with the value <code class="docutils literal notranslate"><span class="pre">extensive</span></code> instead. Similarly,
the <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_ASSERTIONS</span></code> macro will be deprecated (setting it to <code class="docutils literal notranslate"><span class="pre">1</span></code> still enables the extensive mode in
the LLVM 19 release while also issuing a deprecation warning). See <a class="reference internal" href="../Hardening.html#using-hardening-modes"><span class="std std-ref">the hardening documentation</span></a> for more details.</p></li>
<li><p>The base template for <code class="docutils literal notranslate"><span class="pre">std::char_traits</span></code> has been marked as deprecated and will be removed in LLVM 19. If you
are using <code class="docutils literal notranslate"><span class="pre">std::char_traits</span></code> with types other than <code class="docutils literal notranslate"><span class="pre">char</span></code>, <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>, <code class="docutils literal notranslate"><span class="pre">char8_t</span></code>, <code class="docutils literal notranslate"><span class="pre">char16_t</span></code>, <code class="docutils literal notranslate"><span class="pre">char32_t</span></code>
or a custom character type for which you specialized <code class="docutils literal notranslate"><span class="pre">std::char_traits</span></code>, your code will stop working when we
remove the base template. The Standard does not mandate that a base template is provided, and such a base template
is bound to be incorrect for some types, which could currently cause unexpected behavior while going undetected.
Note that the <code class="docutils literal notranslate"><span class="pre">_LIBCPP_CHAR_TRAITS_REMOVE_BASE_SPECIALIZATION</span></code> macro can be defined in LLVM 18 to eagerly remove
the specialization and prepare code bases for the unconditional removal in LLVM 19.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_NARROWING_CONVERSIONS_IN_VARIANT</span></code> macro that changed the behavior for narrowing conversions
in <code class="docutils literal notranslate"><span class="pre">std::variant</span></code> will be removed in LLVM 19.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX20_REMOVED_ALLOCATOR_MEMBERS</span></code> macro has been deprecated in LLVM 18 and will be removed
entirely in LLVM 19.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX17_REMOVED_FEATURES</span></code> and
<code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_CXX20_REMOVED_FEATURES</span></code> macros have been deprecated
in LLVM 18 and will be removed entirely in LLVM 19.</p></li>
<li><p>The macro <code class="docutils literal notranslate"><span class="pre">_LIBCPP_INLINE_VISIBILITY</span></code> has been deprecated in LLVM 18 and
will be removed entirely in LLVM 19.</p></li>
<li><p>The macro <code class="docutils literal notranslate"><span class="pre">_VSTD</span></code> has been deprecated in LLVM 18 and will be removed
entirely in LLVM 19.</p></li>
</ul>
</section>
<section id="llvm-20">
<h4>LLVM 20<a class="headerlink" href="#llvm-20" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">LIBCXX_ENABLE_ASSERTIONS</span></code> CMake variable and the <code class="docutils literal notranslate"><span class="pre">_LIBCPP_ENABLE_ASSERTIONS</span></code> macro that were used to enable
the safe mode will be removed.</p></li>
</ul>
</section>
</section>
<section id="abi-affecting-changes">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">ABI Affecting Changes</a><a class="headerlink" href="#abi-affecting-changes" title="Link to this heading">¶</a></h3>
<ul>
<li><p>When the shared/static library is built with <code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>, the behavior of <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> was changed
to make it standards-conforming. In LLVM 17 and before, the throwing versions of <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> would return
<code class="docutils literal notranslate"><span class="pre">nullptr</span></code> upon failure to allocate, when the shared/static library was built with exceptions disabled. This
was non-conforming, since the throwing versions of <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> are never expected to return <code class="docutils literal notranslate"><span class="pre">nullptr</span></code>, and
this non-conformance could actually lead to miscompiles in subtle cases.</p>
<p>Starting in LLVM 18, the throwing versions of <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> will abort the program when they fail to allocate
if the shared/static library has been built with <code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>. This is consistent with the behavior of all
other potentially-throwing functions in the library, which abort the program instead of throwing when <code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>
is used.</p>
<p>Furthermore, when the shared/static library is built with <code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>, users who override the throwing
version of <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> will now need to also override the <code class="docutils literal notranslate"><span class="pre">std::nothrow_t</span></code> version of <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> if
they want to use it. Indeed, this is because there is no way to implement a conforming <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new(nothrow)</span></code>
from a conforming potentially-throwing <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> when compiled with <code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>. In that case, using
<code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new(nothrow)</span></code> without overriding it explicitly but after overriding the throwing <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> will
result in an error.</p>
<p>Note that this change only impacts vendors/users that build the shared/static library themselves and pass
<code class="docutils literal notranslate"><span class="pre">-DLIBCXX_ENABLE_EXCEPTIONS=OFF</span></code>, which is not the default configuration. If you are using the default
configuration of the library, the libc++ shared/static library will be built with exceptions enabled, and
there is no change between LLVM 17 and LLVM 18, even for users who build their own code using <code class="docutils literal notranslate"><span class="pre">-fno-exceptions</span></code>.</p>
</li>
<li><p>The symbol of a non-visible function part of <code class="docutils literal notranslate"><span class="pre">std::system_error</span></code> was removed.
This is not a breaking change as the private function <code class="docutils literal notranslate"><span class="pre">__init</span></code> was never referenced internally outside of the dylib.</p></li>
<li><p>This release of libc++ added missing visibility annotations on some types in the library. Users compiling with
<code class="docutils literal notranslate"><span class="pre">-fvisbility=hidden</span></code> may notice that additional type infos from libc++ are being exported from their ABI. This is
the correct behavior in almost all cases since exporting the RTTI is required for these types to work properly with
<code class="docutils literal notranslate"><span class="pre">dynamic_cast</span></code>, exceptions and other mechanisms across binaries. However, if you intend to use libc++ purely as an
internal implementation detail (i.e. you use libc++ as a static archive and never export libc++ symbols from your ABI)
and you notice changes to your exported symbols list, then this means that you were not properly preventing libc++
symbols from being part of your ABI.</p></li>
<li><p>The name mangling for instantiations of <code class="docutils literal notranslate"><span class="pre">std::projected</span></code> has changed in order to implement P2538R1. This technically
results in an ABI break, however in practice we expect uses of <code class="docutils literal notranslate"><span class="pre">std::projected</span></code> in ABI-sensitive places to be
extremely rare. Any error resulting from this change should result in a link-time error.</p></li>
<li><p>The internal alignment requirements for heap allocations inside <code class="docutils literal notranslate"><span class="pre">std::string</span></code> has decreased from 16 to 8. This
saves memory since string requests fewer additional bytes than it did previously. However, this also changes the
return value of <code class="docutils literal notranslate"><span class="pre">std::string::max_size</span></code> and can cause code compiled against older libc++ versions but linked at
runtime to a new version to throw a different exception when attempting allocations that are too large
(<code class="docutils literal notranslate"><span class="pre">std::bad_alloc</span></code> vs <code class="docutils literal notranslate"><span class="pre">std::length_error</span></code>).</p></li>
<li><p>The layout of some range adaptors that use the <code class="docutils literal notranslate"><span class="pre">movable-box</span></code> exposition-only type as an implementation
detail has changed in order to fix a <a class="reference external" href="https://github.com/llvm/llvm-project/issues/70506">bug</a> which could result in
overwriting user data following the <code class="docutils literal notranslate"><span class="pre">movable-box</span></code>.
This bug was caused by incorrect usage of the <code class="docutils literal notranslate"><span class="pre">[[no_unique_address]]</span></code> attribute inside the implementation of <code class="docutils literal notranslate"><span class="pre">movable-box</span></code>.
This fix affects the layout of the following views: <code class="docutils literal notranslate"><span class="pre">take_while_view</span></code>, <code class="docutils literal notranslate"><span class="pre">filter_view</span></code>, <code class="docutils literal notranslate"><span class="pre">single_view</span></code>, <code class="docutils literal notranslate"><span class="pre">drop_while_view</span></code>,
<code class="docutils literal notranslate"><span class="pre">repeat_view</span></code>, <code class="docutils literal notranslate"><span class="pre">transform_view</span></code>, <code class="docutils literal notranslate"><span class="pre">chunk_by_view</span></code>. In order to avoid silent breakage as a result of this fix, an ABI tag has been added to
these views such that their mangled name will be different starting in this version of libc++.
As a result, attempting to call a function that expects one of these views will fail to link until the code has been rebuilt
against a matching version of libc++. In practice, we believe it is unusual for these views to appear at ABI boundaries so this
should not be a major problem for most users. However it is probably worth auditing ranges-heavy code for ABI boundaries that
would contain these views, or for types that contain these views as members and which are passed across ABI boundaries.</p></li>
<li><p>Some properties of libc++ may cause ODR-violations when mixing multiple libc++
instances. To avoid these, often benign, ODR-violations the ODR-affecting
properties are now part of the ABI tag. The ODR-affecting properties are:</p>
<blockquote>
<div><ul class="simple">
<li><p>library version (This was part of the ABI tag prior to LLVM 18.)</p></li>
<li><p>exceptions vs no-exceptions</p></li>
<li><p>hardening mode</p></li>
</ul>
</div></blockquote>
<p>This should not be ABI-affecting except that libc++ will be more robust
against different configurations of it being used in different translation
units.</p>
</li>
<li><p>The amount of padding bytes available for use at the end of certain <code class="docutils literal notranslate"><span class="pre">std::expected</span></code> instantiations has changed in this
release. This is an ABI break for any code that held a <code class="docutils literal notranslate"><span class="pre">std::expected</span></code> member with <code class="docutils literal notranslate"><span class="pre">[[no_unique_address]]</span></code> in an
ABI-facing type. In those cases, the layout of the enclosing type will change, breaking the ABI. However, the
<code class="docutils literal notranslate"><span class="pre">std::expected&lt;T,</span> <span class="pre">E&gt;</span></code> member requires a few characteristics in order to be affected by this change:</p>
<ul class="simple">
<li><p>A type equivalent to <code class="docutils literal notranslate"><span class="pre">union</span> <span class="pre">{T</span> <span class="pre">;</span> <span class="pre">E}</span></code> needs to have more than one byte of padding available.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">std::expected&lt;T,</span> <span class="pre">E&gt;</span></code> member must have been in a situation where its padding bytes were previously reused by
another object, which can happen in a few cases (this is probably not exhaustive):</p>
<ul>
<li><p>It is a member with <code class="docutils literal notranslate"><span class="pre">[[no_unique_address]]</span></code> applied to it, and it is followed by another data member, or</p></li>
<li><p>It is a member with <code class="docutils literal notranslate"><span class="pre">[[no_unique_address]]</span></code> applied to it, and it is the last member of the user-defined type,
and that user-defined type is used in ways that its padding bytes can be reused, or</p></li>
<li><p>It is inherited from</p></li>
</ul>
</li>
</ul>
<p>We expect that this will not be a very frequent occurrence. However, there is unfortunately no technique we can use
in the library to catch such misuse. Indeed, even applying an ABI tag to <code class="docutils literal notranslate"><span class="pre">std::expected</span></code> would not help since ABI
tags are not propagated to containing types. As a result, if you notice very difficult to explain bugs around the
usage of a <code class="docutils literal notranslate"><span class="pre">std::expected</span></code>, you should consider checking whether you are hitting this ABI break. This change was
done to fix <a class="reference external" href="https://github.com/llvm/llvm-project/issues/70494">#70494</a> and the vendor communication is handled
in <a class="reference external" href="https://github.com/llvm/llvm-project/issues/70820">#70820</a>.</p>
</li>
</ul>
</section>
<section id="build-system-changes">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Build System Changes</a><a class="headerlink" href="#build-system-changes" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">LIBCXX_EXECUTOR</span></code> CMake variable has been deprecated. If you are relying on this, the new replacement is
passing <code class="docutils literal notranslate"><span class="pre">-Dexecutor=...</span></code> to <code class="docutils literal notranslate"><span class="pre">llvm-lit</span></code>. Alternatively, this flag can be made persistent in the generated test
configuration file by passing <code class="docutils literal notranslate"><span class="pre">-DLIBCXX_TEST_PARAMS=executor=...</span></code>. This also applies to the <code class="docutils literal notranslate"><span class="pre">LIBUWIND_EXECTOR</span></code>
and <code class="docutils literal notranslate"><span class="pre">LIBCXXABI_EXECUTOR</span></code> CMake variables. LLVM 19 will completely remove support for the <code class="docutils literal notranslate"><span class="pre">*_EXECUTOR</span></code> variables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIBCXXABI_USE_LLVM_UNWINDER</span></code> and <code class="docutils literal notranslate"><span class="pre">COMPILER_RT_USE_LLVM_UNWINDER</span></code> switched defaults from <code class="docutils literal notranslate"><span class="pre">OFF</span></code> to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.
This means that by default, libc++abi and compiler-rt will link against the LLVM provided <code class="docutils literal notranslate"><span class="pre">libunwind</span></code> library
instead of the system-provided unwinding library. If you are building the LLVM runtimes with the goal of shipping
them so that they can interoperate with other system-provided libraries that might be using a different unwinding
library (such as <code class="docutils literal notranslate"><span class="pre">libgcc_s</span></code>), you should pass <code class="docutils literal notranslate"><span class="pre">LIBCXXABI_USE_LLVM_UNWINDER=OFF</span></code> and <code class="docutils literal notranslate"><span class="pre">COMPILER_RT_USE_LLVM_UNWINDER=OFF</span></code>
to make sure the system-provided unwinding library is used by the LLVM runtimes.</p></li>
</ul>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="../ReleaseNotes.html">Libc++ 19.0.0 (In-Progress) Release Notes</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="20.html">Libc++ 20.0.0 (In-Progress) Release Notes</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2011-2024, LLVM Project.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>